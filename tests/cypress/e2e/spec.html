<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/picocss/1.5.6/pico.min.css" />
  <script type="module">
    import validityDirective from "../../../dist/alpine-validity.js"

    document.addEventListener("alpine:initializing", () => {
      validityDirective(window.Alpine)
    })
  </script>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.12.0/dist/cdn.min.js" defer></script>
  <script>
    const isMoreThan5 = (value) => {
      return value.length > 5
    }

    const notEmpty = (value) => {
      return value.length > 0
    }

    const customMessagesRoot = {
      isMoreThan5: ">5",
      notEmpty: ">0",
      valueMissing: "You forgot to enter your email address! - 1",
      typeMismatch: "This appears to be an invalid email address. - 1"
    }

    const customMessages = {
      isMoreThan5: ">5",
      notEmpty: ">0",
      valueMissing: "You forgot to enter your email address!",
      typeMismatch: "This appears to be an invalid email address."
    }
  </script>
</head>
<!-- TODO MOVE THIS FILE SOMEWHERE ELSE :D -->
<body>
  <main class="container">
    <ins id="alpine-loaded" x-data x-text="'alpine-loaded'"></ins>
    <article>
      <h2>form 1</h2>
      <form id="form-1" x-validity x-data="{isFormValid: false}" _@validation="isFormValid = $el.checkValidity()"
        @submit.prevent>
        <div>
          <input type="text" id="test-field" required />
          <small class="errorMessage" x-text="$validity('test-field')"></small>
        </div>
        <button>submit</button>
      </form>
    </article>
    <article>
      <h2>form 2</h2>
      <form id="form-2" x-validity x-data="{isFormValid: false}" @validation="isFormValid = $el.checkValidity()"
        x-validity:messages="{valueMissing: 'valueMissing custom'}" @submit.prevent>
        <div x-data="{error:''}" @validation="error = $event.detail.error">
          <input type="text" required />
          <small class="errorMessage" x-text="error"></small>
        </div>
        <button>submit</button>
      </form>
    </article>
    <article>
      <h1>form 3</h1>
      <form id="form-3" x-data x-validity @submit.prevent x-validity:messages="customMessagesRoot">
        <div>
          <input type="email" id="test-field-2" x-validity:controls="[notEmpty, isMoreThan5]"
            x-validity:messages="customMessages" />
          <small class="errorMessage" x-text="$validity('test-field-2')"></small>
        </div>
        <div>
          <input type="email" id="test-field-3" required />
          <small class="errorMessage" x-text="$validity('test-field-3')"></small>
        </div>
        <button>submit</button>
      </form>
    </article>
    <article>
      <h2>form 4</h2>
      <div x-data="{
	          forms: [{id: $id('form'), name: 'roger', email: 'roger@email.com'}], 
	          add(data) {this.forms = [...this.forms, data]}, 
	          remove(index) { this.forms = [...this.forms.filter((form) => index != form.id)]  } }">
        <form @submit.prevent x-data="{isFormValid: false}" @validation="isFormValid = $event.detail.validity"
          x-validity id="form-4">
          <template x-for="(form, index) in forms" :key="form.id">
            <div class="grid form-row">
              <div class="input-name">
                <input type="text" required :id="`name-${form.id}`" x-validity:messages="customMessages"
                  :name="`name-${form.id}`" :value="form.name" :placeholder="`Name ${form.id}`" />
                <small class="errorMessage" x-text="$validity(`name-${form.id}`)"></small>
              </div>
              <div class="input-mail">
                <input type="email" required :id="`email-${form.id}`" x-validity:messages="customMessages"
                  :name="`email-${form.id}`" :value="form.email" :placeholder="`Email ${form.id}`" />
                <small class="errorMessage" x-text="$validity(`email-${form.id}`)"></small>
              </div>
              <button type="button" class="secondary" @click="() => remove(form.id)">
                remove
              </button>
            </div>
          </template>
          <button type="button" class="add-btn" @click="add({id: $id('form'), name: '', email: ''})">
            add user
          </button>
          <hr />
          <button type="submit">
            Submit
          </button>
          <small>on submit: check browser console</small>
          <hr />
          form validity: <span class="form-status" x-text="!isFormValid ? 'invalid': 'valid'"></span>
        </form>
      </div>
    </article>
  </main>
</body>

</html>