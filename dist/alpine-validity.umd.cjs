(function(r,u){typeof exports=="object"&&typeof module<"u"?module.exports=u():typeof define=="function"&&define.amd?define(u):(r=typeof globalThis<"u"?globalThis:r||self,r["alpine-validity"]=u())})(this,function(){"use strict";return u=>{const v=(i,t)=>{const a=i.validity,s=i._x_validity_messages||t._x_validity_messages||[],o=i._x_validity_controls||t._x_validity_controls||[];let d=!1,e;i.setCustomValidity("");for(const n in a)if(!["valid","customError"].includes(n)&&a[n]===!0){d=!0,e=s[n]||i.validationMessage;break}d||o.find(n=>(d=!n(i.value),d?(i.setCustomValidity(s[n.name]),e=s[n.name],!0):!1)),i.dispatchEvent(new CustomEvent("validation",{detail:{error:d?e:"",validity:t.checkValidity()},bubbles:!0}))},c=(i,t,a,s,o)=>{const d=a(s);o(()=>{d(e=>{t[`_x_validity_${i}`]||(t[`_x_validity_${i}`]={}),t[`_x_validity_${i}`]=e})})};u.directive("validity",(i,{value:t,expression:a},{evaluateLater:s,effect:o,cleanup:d})=>{if(t==="controls")c("controls",i,s,a,o);else if(t==="messages")c("messages",i,s,a,o);else{const e=i;new MutationObserver(()=>{e.dispatchEvent(new CustomEvent("validation",{detail:{validity:e.checkValidity()}}))}).observe(e,{childList:!0}),e.setAttribute("novalidate",!0),["input","change"].forEach(_=>e.addEventListener(_,({target:l,type:f})=>{if((l._x_validity_modified??!1)&&f==="input"&&(l._x_validity_modified=!0),!(l._x_validity_blurred??!1)&&f==="change"&&(l._x_validity_blurred=!0),!l._x_validity_blurred&&!l._x_validity_modified)return!1;v(l,l.form)})),e.addEventListener("submit",()=>{Array.from(e.elements).filter(_=>_.willValidate).forEach(_=>{_._x_validity_blurred=!0,v(_,e)})})}})}});
